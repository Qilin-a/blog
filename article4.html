<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>前端性能优化实战指南 - 我的博客</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
</head>
<body class="bg-gray-50 text-gray-800 min-h-screen flex flex-col">
    <!-- 导航栏 -->
    <nav class="bg-white shadow-sm sticky top-0 z-10">
        <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16">
                <div class="flex items-center">
                    <a href="index.html" class="text-xl font-bold text-blue-600">我的博客</a>
                </div>
                <div class="flex items-center space-x-4">
                    <a href="index.html" class="px-3 py-2 rounded-md text-sm font-medium text-gray-600 hover:text-blue-600">首页</a>
                    <a href="about.html" class="px-3 py-2 rounded-md text-sm font-medium text-gray-600 hover:text-blue-600">关于我</a>
                </div>
            </div>
        </div>
    </nav>

    <!-- 文章内容区 -->
    <main class="flex-grow max-w-3xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <!-- 文章标题与信息 -->
        <div class="mb-8">
            <h1 class="text-3xl font-bold text-gray-900 mb-4">前端性能优化实战指南</h1>
            <div class="text-gray-500 text-sm flex items-center gap-4">
                <span><i class="fa fa-calendar-o mr-1"></i> 2024年4月18日</span>
                <span><i class="fa fa-clock-o mr-1"></i> 阅读时间：7分钟</span>
                <span><i class="fa fa-comment-o mr-1"></i> <span id="comment-count">23</span>条评论</span>
            </div>
        </div>

        <!-- 文章正文 -->
        <div class="prose max-w-none text-gray-700 space-y-4 mb-12">
            <p>前端性能直接影响用户体验和留存率。研究表明，页面加载时间每增加1秒，转化率可能下降7%。本文分享10个经过实战验证的前端性能优化技巧，帮助你提升网站速度和用户体验。</p>
            
            <h2 class="text-2xl font-semibold text-gray-800 mt-8 mb-4">一、资源加载优化</h2>
            
            <h3 class="text-xl font-semibold text-gray-800 mt-4 mb-2">1. 图片优化</h3>
            <p>图片通常是页面中体积最大的资源，优化图片能显著提升性能。</p>
            <ul class="list-disc pl-5 space-y-2">
                <li>使用现代图片格式：WebP或AVIF，比JPEG和PNG小30%以上</li>
                <li>根据设备尺寸加载不同分辨率的图片（响应式图片）</li>
                <li>使用图片CDN服务，自动优化和裁剪图片</li>
                <li>对非关键图片使用懒加载</li>
            </ul>
            
            <pre class="bg-gray-100 p-4 rounded-md text-sm"><code>&lt;!-- 响应式图片示例 --&gt;
&lt;picture&gt;
  &lt;source srcset="image-large.avif" media="(min-width: 1024px)" type="image/avif"&gt;
  &lt;source srcset="image-medium.avif" media="(min-width: 768px)" type="image/avif"&gt;
  &lt;img src="image-small.webp" alt="示例图片" loading="lazy"&gt;
&lt;/picture&gt;</code></pre>
            
            <h3 class="text-xl font-semibold text-gray-800 mt-4 mb-2">2. JavaScript和CSS优化</h3>
            <ul class="list-disc pl-5 space-y-2">
                <li>压缩和混淆JS/CSS文件（使用Terser、CSSNano等工具）</li>
                <li>拆分代码，实现按需加载（Code Splitting）</li>
                <li>非关键JS使用async或defer属性</li>
                <li>关键CSS内联到HTML中，非关键CSS异步加载</li>
            </ul>
            
            <pre class="bg-gray-100 p-4 rounded-md text-sm"><code>&lt;!-- 异步加载非关键JS --&gt;
&lt;script src="non-critical.js" defer&gt;&lt;/script&gt;

&lt;!-- 内联关键CSS --&gt;
&lt;style&gt;
  /* 只包含首屏渲染必需的CSS */
  .header { ... }
  .hero { ... }
&lt;/style&gt;

&lt;!-- 异步加载非关键CSS --&gt;
&lt;link rel="preload" href="non-critical.css" as="style" onload="this.onload=null;this.rel='stylesheet'"&gt;
&lt;noscript&gt;&lt;link rel="stylesheet" href="non-critical.css"&gt;&lt;/noscript&gt;</code></pre>

            <h2 class="text-2xl font-semibold text-gray-800 mt-8 mb-4">二、缓存策略</h2>
            <p>合理的缓存策略可以减少重复请求，大幅提升重复访问的加载速度。</p>
            
            <h3 class="text-xl font-semibold text-gray-800 mt-4 mb-2">1. HTTP缓存</h3>
            <ul class="list-disc pl-5 space-y-2">
                <li>对静态资源设置长期缓存（Cache-Control: max-age=31536000）</li>
                <li>使用内容哈希命名文件（如app.a1b2c3.js），实现缓存击穿</li>
                <li>对API数据使用适当的缓存策略（ETag或Last-Modified）</li>
            </ul>
            
            <h3 class="text-xl font-semibold text-gray-800 mt-4 mb-2">2. 本地存储缓存</h3>
            <ul class="list-disc pl-5 space-y-2">
                <li>使用localStorage缓存不常变化的API数据</li>
                <li>考虑使用Service Worker实现离线缓存和预缓存</li>
            </ul>

            <h2 class="text-2xl font-semibold text-gray-800 mt-8 mb-4">三、渲染性能优化</h2>
            <p>即使页面加载完成，不良的渲染性能也会导致页面卡顿，影响用户体验。</p>
            
            <h3 class="text-xl font-semibold text-gray-800 mt-4 mb-2">1. 减少重排（Reflow）和重绘（Repaint）</h3>
            <ul class="list-disc pl-5 space-y-2">
                <li>避免频繁操作DOM，尽量批量处理</li>
                <li>使用DocumentFragment或离线DOM进行DOM操作</li>
                <li>避免使用table布局，它的重排成本高</li>
                <li>使用will-change或transform: translateZ(0)提示浏览器优化渲染</li>
            </ul>
            
            <h3 class="text-xl font-semibold text-gray-800 mt-4 mb-2">2. 优化JavaScript执行</h3>
            <ul class="list-disc pl-5 space-y-2">
                <li>将长任务拆分为小任务，使用requestIdleCallback</li>
                <li>避免在scroll、resize等高频事件中执行复杂操作</li>
                <li>使用Web Workers处理计算密集型任务，避免阻塞主线程</li>
            </ul>

            <h2 class="text-2xl font-semibold text-gray-800 mt-8 mb-4">四、性能监控与分析</h2>
            <p>优化性能首先需要测量性能，以下是一些实用的性能监控工具和方法：</p>
            <ul class="list-disc pl-5 space-y-2">
                <li>Lighthouse：Google开发的网页性能评估工具</li>
                <li>WebPageTest：提供详细的加载性能分析和瀑布图</li>
                <li>Chrome DevTools：Performance面板可以录制和分析运行时性能</li>
                <li>Core Web Vitals：Google推荐的关键用户体验指标</li>
            </ul>
            
            <h2 class="text-2xl font-semibold text-gray-800 mt-8 mb-4">五、优化优先级</h2>
            <p>性能优化资源有限，建议按以下优先级进行：</p>
            <ol class="list-decimal pl-5 space-y-2">
                <li>优化首屏加载时间（LCP - Largest Contentful Paint）</li>
                <li>优化交互响应速度（FID - First Input Delay）</li>
                <li>优化视觉稳定性（CLS - Cumulative Layout Shift）</li>
                <li>优化整体加载性能</li>
            </ol>
            
            <p>性能优化是一个持续的过程，没有一劳永逸的解决方案。建议建立性能预算和监控体系，在开发新功能时始终关注性能影响。</p>
        </div>

        <!-- 返回首页按钮 -->
        <div class="mt-12 mb-16">
            <a href="index.html" class="inline-block px-6 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors">
                <i class="fa fa-arrow-left mr-1"></i> 返回首页
            </a>
        </div>

        <!-- 评论区 -->
        <div class="mt-16 border-t pt-8">
            <h2 class="text-2xl font-bold mb-6">评论区</h2>
            
            <!-- 评论表单 -->
            <div class="bg-white p-6 rounded-lg shadow-sm mb-8">
                <h3 class="text-lg font-semibold mb-4">发表评论</h3>
                <form id="comment-form" class="space-y-4">
                    <div>
                        <label for="name" class="block text-sm font-medium text-gray-700 mb-1">昵称</label>
                        <input type="text" id="name" name="name" required
                            class="w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                    </div>
                    <div>
                        <label for="comment" class="block text-sm font-medium text-gray-700 mb-1">评论内容</label>
                        <textarea id="comment" name="comment" rows="4" required
                            class="w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500"></textarea>
                    </div>
                    <button type="submit" class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors">
                        提交评论
                    </button>
                </form>
            </div>
            
            <!-- 评论列表 -->
            <div id="comments-container" class="space-y-6">
                <!-- 评论会通过JS动态加载 -->
            </div>
        </div>
    </main>

    <!-- 底部 -->
    <footer class="bg-gray-800 text-white py-8">
        <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
            <p>© 2025 我的个人博客 | 保持热爱，持续分享</p>
        </div>
    </footer>

    <!-- 评论功能JS -->
    <script>
        // 文章ID，用于区分不同文章的评论
        const articleId = 'article4';
        
        // 页面加载时获取并显示评论
        document.addEventListener('DOMContentLoaded', () => {
            loadComments();
            
            // 评论表单提交事件
            document.getElementById('comment-form').addEventListener('submit', (e) => {
                e.preventDefault();
                submitComment();
            });
        });
        
        // 加载评论
        function loadComments() {
            const comments = JSON.parse(localStorage.getItem(`comments_${articleId}`) || '[]');
            const container = document.getElementById('comments-container');
            const commentCount = document.getElementById('comment-count');
            
            // 更新评论数量
            commentCount.textContent = comments.length;
            
            // 清空容器
            container.innerHTML = '';
            
            // 如果没有评论，显示提示信息
            if (comments.length === 0) {
                container.innerHTML = '<p class="text-gray-500 italic">暂无评论，快来发表第一条评论吧！</p>';
                return;
            }
            
            // 渲染评论
            comments.forEach((comment, index) => {
                const commentElement = document.createElement('div');
                commentElement.className = 'bg-white p-6 rounded-lg shadow-sm';
                commentElement.innerHTML = `
                    <div class="flex justify-between items-start mb-2">
                        <h4 class="font-semibold text-gray-900">${escapeHTML(comment.name)}</h4>
                        <span class="text-gray-500 text-sm">${formatDate(comment.date)}</span>
                    </div>
                    <p class="text-gray-700 mb-4">${escapeHTML(comment.content)}</p>
                    <button class="text-red-500 text-sm hover:text-red-700 transition-colors delete-comment" 
                            data-index="${index}">
                        <i class="fa fa-trash-o mr-1"></i> 删除
                    </button>
                `;
                container.appendChild(commentElement);
            });
            
            // 为删除按钮添加事件监听
            document.querySelectorAll('.delete-comment').forEach(button => {
                button.addEventListener('click', (e) => {
                    const index = parseInt(e.target.dataset.index || e.target.parentElement.dataset.index);
                    deleteComment(index);
                });
            });
        }
        
        // 提交评论
        function submitComment() {
            const nameInput = document.getElementById('name');
            const commentInput = document.getElementById('comment');
            
            const name = nameInput.value.trim();
            const content = commentInput.value.trim();
            
            if (!name || !content) {
                alert('请填写昵称和评论内容');
                return;
            }
            
            // 创建评论对象
            const comment = {
                name: name,
                content: content,
                date: new Date().toISOString()
            };
            
            // 从本地存储获取现有评论
            const comments = JSON.parse(localStorage.getItem(`comments_${articleId}`) || '[]');
            
            // 添加新评论到数组开头
            comments.unshift(comment);
            
            // 保存回本地存储
            localStorage.setItem(`comments_${articleId}`, JSON.stringify(comments));
            
            // 重新加载评论
            loadComments();
            
            // 清空表单
            nameInput.value = '';
            commentInput.value = '';
            
            // 显示成功提示
            alert('评论发表成功！');
        }
        
        // 删除评论
        function deleteComment(index) {
            if (confirm('确定要删除这条评论吗？')) {
                // 从本地存储获取现有评论
                const comments = JSON.parse(localStorage.getItem(`comments_${articleId}`) || '[]');
                
                // 删除指定索引的评论
                comments.splice(index, 1);
                
                // 保存回本地存储
                localStorage.setItem(`comments_${articleId}`, JSON.stringify(comments));
                
                // 重新加载评论
                loadComments();
            }
        }
        
        // 格式化日期
        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleString('zh-CN', {
                year: 'numeric',
                month: 'long',
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
        }
        
        // 防止XSS攻击，转义HTML特殊字符
        function escapeHTML(str) {
            return str
                .replace(/&/g, '&amp;')
                .replace(/</g, '&lt;')
                .replace(/>/g, '&gt;')
                .replace(/"/g, '&quot;')
                .replace(/'/g, '&#039;');
        }
    </script>
</body>
</html>
